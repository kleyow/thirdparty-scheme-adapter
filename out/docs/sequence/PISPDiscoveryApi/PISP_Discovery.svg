<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1761px" preserveAspectRatio="none" style="width:2450px;height:1761px;" version="1.1" viewBox="0 0 2450 1761" width="2450px" zoomAndPan="magnify"><defs><filter height="300%" id="fgdr8uyqmr0bg" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="133" x="1155.25" y="28.708">PISP Discovery</text><rect fill="#DDDDDD" height="1714.6953" style="stroke:#A80036;stroke-width:1.0;" width="763.5" x="407.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="699.25" y="53.02">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="1714.6953" style="stroke:#A80036;stroke-width:1.0;" width="73" x="1393" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="1396" y="53.02">Mojaloop</text><rect fill="#DDDDDD" height="1714.6953" style="stroke:#A80036;stroke-width:1.0;" width="419.5" x="1644" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186" x="1760.75" y="53.02">DFSP tp-scheme-adapter</text><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="1529.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="66.5" y="169.6484"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="1529.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="473.5" y="169.6484"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="196.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="750.5" y="240.9141"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="750.5" y="1084.2969"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="750.5" y="1641.0859"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1100.5" y="1026.0313"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1100.5" y="1582.8203"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="150.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1424.5" y="345.3125"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1424.5" y="967.7656"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1424.5" y="1524.5547"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="100.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1704.5" y="466.9766"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="429.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1972.5" y="567.375"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="411.125" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1972.5" y="1142.5625"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="71" x2="71" y1="95.3828" y2="1717.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="478.5" x2="478.5" y1="95.3828" y2="1717.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="755" x2="755" y1="95.3828" y2="1717.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1105" x2="1105" y1="95.3828" y2="1717.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1429" x2="1429" y1="95.3828" y2="1717.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1709" x2="1709" y1="95.3828" y2="1717.3516"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1977.5" x2="1977.5" y1="95.3828" y2="1717.3516"/><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="15" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="22" y="80.0811">PISP Backend</text><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="15" y="1716.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="22" y="1736.3467">PISP Backend</text><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="411.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="418.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="411.5" y="1716.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="418.5" y="1736.3467">outbound-server</text><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="153" x="677" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="684" y="80.0811">PISPDiscoveryModel</text><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="153" x="677" y="1716.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="684" y="1736.3467">PISPDiscoveryModel</text><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1044" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1051" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1044" y="1716.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1051" y="1736.3467">inbound-server</text><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1398" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1405" y="80.0811">Switch</text><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1398" y="1716.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1405" y="1736.3467">Switch</text><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1648" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1655" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1648" y="1716.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1655" y="1736.3467">inbound-server</text><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="160" x="1895.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="1902.5" y="80.0811">DFSPDiscoveryModel</text><rect fill="#FEFECE" filter="url(#fgdr8uyqmr0bg)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="160" x="1895.5" y="1716.3516"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="1902.5" y="1736.3467">DFSPDiscoveryModel</text><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="1529.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="66.5" y="169.6484"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="1529.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="473.5" y="169.6484"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="196.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="750.5" y="240.9141"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="750.5" y="1084.2969"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="750.5" y="1641.0859"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1100.5" y="1026.0313"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="58.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1100.5" y="1582.8203"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="150.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1424.5" y="345.3125"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1424.5" y="967.7656"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1424.5" y="1524.5547"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="100.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1704.5" y="466.9766"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="429.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1972.5" y="567.375"/><rect fill="#FFFFFF" filter="url(#fgdr8uyqmr0bg)" height="411.125" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1972.5" y="1142.5625"/><rect fill="#EEEEEE" filter="url(#fgdr8uyqmr0bg)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="2443.5" x="0" y="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2443.5" y1="125.9492" y2="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="2443.5" y1="128.9492" y2="128.9492"/><rect fill="#EEEEEE" filter="url(#fgdr8uyqmr0bg)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="90" x="1176.75" y="115.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="71" x="1182.75" y="131.4497">Discovery</text><polygon fill="#A80036" points="461.5,165.6484,471.5,169.6484,461.5,173.6484,465.5,169.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="76.5" x2="467.5" y1="169.6484" y2="169.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="83.5" y="164.5825">LOOK-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="141.5" y="164.5825">GET /accounts/dfspa/username1234</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="198.7813" y2="198.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="198.7813" y2="211.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="211.7813" y2="211.7813"/><polygon fill="#A80036" points="494.5,207.7813,484.5,211.7813,494.5,215.7813,490.5,211.7813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="490.5" y="193.7153">LOOK-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="548.5" y="193.7153">const model = await create()</text><polygon fill="#A80036" points="738.5,236.9141,748.5,240.9141,738.5,244.9141,742.5,240.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="744.5" y1="240.9141" y2="240.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="490.5" y="235.8481">LOOK-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="548.5" y="235.8481">model.getAccounts()</text><rect fill="#FBFB77" filter="url(#fgdr8uyqmr0bg)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="157" x="765" y="253.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="769" y="269.981">state: requestAccounts</text><line style="stroke:#A80036;stroke-width:1.0;" x1="760.5" x2="802.5" y1="303.1797" y2="303.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="802.5" x2="802.5" y1="303.1797" y2="316.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="761.5" x2="802.5" y1="316.1797" y2="316.1797"/><polygon fill="#A80036" points="771.5,312.1797,761.5,316.1797,771.5,320.1797,767.5,316.1797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="767.5" y="298.1138">LOOK-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="825.5" y="298.1138">ThirdpartyRequests.getAccounts()</text><polygon fill="#A80036" points="1412.5,341.3125,1422.5,345.3125,1412.5,349.3125,1416.5,345.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="760.5" x2="1418.5" y1="345.3125" y2="345.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="767.5" y="340.2466">LOOK-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="825.5" y="340.2466">GET /accounts/username1234</text><rect fill="#ADD8E6" filter="url(#fgdr8uyqmr0bg)" height="53" style="stroke:#A80036;stroke-width:1.0;" width="200" x="765" y="358.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="769" y="374.3794">GET /accounts/username1234</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="777" y="389.5122">FSIOP-Source: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158" x="777" y="404.645">FSIOP-Destination: dfspa</text><polygon fill="#A80036" points="766.5,433.8438,756.5,437.8438,766.5,441.8438,762.5,437.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="760.5" x2="1423.5" y1="437.8438" y2="437.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="772.5" y="432.7778">LOOK-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="830.5" y="432.7778">202 Accepted</text><polygon fill="#A80036" points="1692.5,462.9766,1702.5,466.9766,1692.5,470.9766,1696.5,466.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1434.5" x2="1698.5" y1="466.9766" y2="466.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="1441.5" y="461.9106">LOOK-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1499.5" y="461.9106">GET /accounts/username1234</text><polygon fill="#A80036" points="1440.5,492.1094,1430.5,496.1094,1440.5,500.1094,1436.5,496.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1434.5" x2="1703.5" y1="496.1094" y2="496.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="1446.5" y="491.0435">LOOK-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1504.5" y="491.0435">202 Accepted</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1714.5" x2="1756.5" y1="525.2422" y2="525.2422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1756.5" x2="1756.5" y1="525.2422" y2="538.2422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1715.5" x2="1756.5" y1="538.2422" y2="538.2422"/><polygon fill="#A80036" points="1725.5,534.2422,1715.5,538.2422,1725.5,542.2422,1721.5,538.2422" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="1721.5" y="520.1763">LOOK-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="1779.5" y="520.1763">const model = await create()</text><polygon fill="#A80036" points="1960.5,563.375,1970.5,567.375,1960.5,571.375,1964.5,567.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1709.5" x2="1966.5" y1="567.375" y2="567.375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1716.5" y="562.3091">LOOK-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="1783.5" y="562.3091">model.retrieveAccounts()</text><path d="M5,580.375 L5,605.375 L2044,605.375 L2044,590.375 L2034,580.375 L5,580.375 " fill="#FBFB77" filter="url(#fgdr8uyqmr0bg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2034,580.375 L2034,590.375 L2044,590.375 L2034,580.375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="311" x="862.75" y="597.4419">HAPPY_SCENARIO: DFSP returns list of accounts.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1982.5" x2="2024.5" y1="635.6406" y2="635.6406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2024.5" x2="2024.5" y1="635.6406" y2="648.6406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1983.5" x2="2024.5" y1="648.6406" y2="648.6406"/><polygon fill="#A80036" points="1993.5,644.6406,1983.5,648.6406,1993.5,652.6406,1989.5,648.6406" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1989.5" y="630.5747">LOOK-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="2056.5" y="630.5747">DFSPBackendRequests.getUserAccounts('username1234')</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1982.5" x2="2024.5" y1="677.7734" y2="677.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2024.5" x2="2024.5" y1="677.7734" y2="690.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1983.5" x2="2024.5" y1="690.7734" y2="690.7734"/><polygon fill="#A80036" points="1993.5,686.7734,1983.5,690.7734,1993.5,694.7734,1989.5,690.7734" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1989.5" y="672.7075">LOOK-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="2056.5" y="672.7075">Accounts returned.</text><rect fill="#FBFB77" filter="url(#fgdr8uyqmr0bg)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="167" x="1987" y="703.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159" x="1991" y="719.8403">state: accountsRetrieved</text><rect fill="#ADD8E6" filter="url(#fgdr8uyqmr0bg)" height="204" style="stroke:#A80036;stroke-width:1.0;" width="570" x="1397" y="736.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="354" x="1401" y="752.9731">NOTE: This deviates from the original design document.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="318" x="1425" y="768.106">Which has the response as a top-level array which</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="1425" y="783.2388">is a security and expandability risk.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="1425" y="798.3716">Fixing that here.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1401" y="813.5044">PUT /accounts/username1234</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1401" y="828.6372">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="1401" y="843.77">FSIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1401" y="858.9028">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="81" x="1409" y="874.0356">"accounts": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="507" x="1417" y="889.1685">{ accountNickname: "XXXXXXnt", id: "dfspa.username.1234", currency: "ZAR" },</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="546" x="1417" y="904.3013">{ accountNickname: "SpeXXXXXXXXnt", id: "dfspa.username.5678", currency: "USD" }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="1409" y="919.4341">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1401" y="934.5669">}</text><polygon fill="#A80036" points="1445.5,963.7656,1435.5,967.7656,1445.5,971.7656,1441.5,967.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1439.5" x2="1971.5" y1="967.7656" y2="967.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1451.5" y="962.6997">LOOK-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1518.5" y="962.6997">PUT /accounts/username1234</text><polygon fill="#A80036" points="1965.5,992.8984,1975.5,996.8984,1965.5,1000.8984,1969.5,996.8984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1434.5" x2="1971.5" y1="996.8984" y2="996.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1441.5" y="991.8325">LOOK-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1508.5" y="991.8325">200 OK</text><polygon fill="#A80036" points="1121.5,1022.0313,1111.5,1026.0313,1121.5,1030.0313,1117.5,1026.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1115.5" x2="1423.5" y1="1026.0313" y2="1026.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1127.5" y="1020.9653">LOOK-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="1194.5" y="1020.9653">PUT /accounts/username1234</text><polygon fill="#A80036" points="1417.5,1051.1641,1427.5,1055.1641,1417.5,1059.1641,1421.5,1055.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1110.5" x2="1423.5" y1="1055.1641" y2="1055.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1117.5" y="1050.0981">LOOK-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1184.5" y="1050.0981">200 OK</text><polygon fill="#A80036" points="771.5,1080.2969,761.5,1084.2969,771.5,1088.2969,767.5,1084.2969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="765.5" x2="1104.5" y1="1084.2969" y2="1084.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="777.5" y="1079.231">LOOK-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="844.5" y="1079.231">Accounts response recieved</text><polygon fill="#A80036" points="494.5,1109.4297,484.5,1113.4297,494.5,1117.4297,490.5,1113.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="488.5" x2="754.5" y1="1113.4297" y2="1113.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="500.5" y="1108.3638">LOOK-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="102" x="567.5" y="1108.3638">return Accounts</text><polygon fill="#A80036" points="87.5,1138.5625,77.5,1142.5625,87.5,1146.5625,83.5,1142.5625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="81.5" x2="472.5" y1="1142.5625" y2="1142.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="93.5" y="1137.4966">LOOK-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="160.5" y="1137.4966">200 OK Accounts</text><path d="M5,1155.5625 L5,1180.5625 L2044,1180.5625 L2044,1165.5625 L2034,1155.5625 L5,1155.5625 " fill="#FBFB77" filter="url(#fgdr8uyqmr0bg)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M2034,1155.5625 L2034,1165.5625 L2044,1165.5625 L2034,1155.5625 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="509" x="763.75" y="1172.6294">ERROR_SCENARIO: Switch receives 7202 No accounts found for generic ID error.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1982.5" x2="2024.5" y1="1210.8281" y2="1210.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2024.5" x2="2024.5" y1="1210.8281" y2="1223.8281"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1983.5" x2="2024.5" y1="1223.8281" y2="1223.8281"/><polygon fill="#A80036" points="1993.5,1219.8281,1983.5,1223.8281,1993.5,1227.8281,1989.5,1223.8281" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1989.5" y="1205.7622">LOOK-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="375" x="2056.5" y="1205.7622">DFSPBackendRequests.getUserAccounts('username1234')</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1982.5" x2="2024.5" y1="1252.9609" y2="1252.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2024.5" x2="2024.5" y1="1252.9609" y2="1265.9609"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1983.5" x2="2024.5" y1="1265.9609" y2="1265.9609"/><polygon fill="#A80036" points="1993.5,1261.9609,1983.5,1265.9609,1993.5,1269.9609,1989.5,1265.9609" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1989.5" y="1247.895">LOOK-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="2056.5" y="1247.895">No accounts returned.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1982.5" x2="2024.5" y1="1295.0938" y2="1295.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="2024.5" x2="2024.5" y1="1295.0938" y2="1308.0938"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1983.5" x2="2024.5" y1="1308.0938" y2="1308.0938"/><polygon fill="#A80036" points="1993.5,1304.0938,1983.5,1308.0938,1993.5,1312.0938,1989.5,1308.0938" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1989.5" y="1290.0278">LOOK-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="2056.5" y="1290.0278">throw MojaloopFSPIOPError</text><rect fill="#FBFB77" filter="url(#fgdr8uyqmr0bg)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="96" x="1987" y="1321.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1991" y="1337.1606">state: errored</text><rect fill="#F08080" filter="url(#fgdr8uyqmr0bg)" height="144" style="stroke:#A80036;stroke-width:1.0;" width="350" x="1617" y="1354.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1621" y="1370.2935">PUT /accounts/username1234/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="1621" y="1385.4263">FSIOP-Source: dfspa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="1621" y="1400.5591">FSIOP-Destination: pispa</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1621" y="1415.6919">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="1629" y="1430.8247">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="1637" y="1445.9575">errorCode: '7202',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="1637" y="1461.0903">errorDescription: 'No accounts found for generic ID'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1629" y="1476.2231">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1621" y="1491.356">}</text><polygon fill="#A80036" points="1445.5,1520.5547,1435.5,1524.5547,1445.5,1528.5547,1441.5,1524.5547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1439.5" x2="1971.5" y1="1524.5547" y2="1524.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1451.5" y="1519.4888">LOOK-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1518.5" y="1519.4888">PUT /accounts/username1234/error</text><polygon fill="#A80036" points="1965.5,1549.6875,1975.5,1553.6875,1965.5,1557.6875,1969.5,1553.6875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1434.5" x2="1971.5" y1="1553.6875" y2="1553.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1441.5" y="1548.6216">LOOK-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1508.5" y="1548.6216">200 OK</text><polygon fill="#A80036" points="1121.5,1578.8203,1111.5,1582.8203,1121.5,1586.8203,1117.5,1582.8203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1115.5" x2="1423.5" y1="1582.8203" y2="1582.8203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1127.5" y="1577.7544">LOOK-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="1194.5" y="1577.7544">PUT /accounts/username1234/error</text><polygon fill="#A80036" points="1417.5,1607.9531,1427.5,1611.9531,1417.5,1615.9531,1421.5,1611.9531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1110.5" x2="1423.5" y1="1611.9531" y2="1611.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1117.5" y="1606.8872">LOOK-26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1184.5" y="1606.8872">200 OK</text><polygon fill="#A80036" points="771.5,1637.0859,761.5,1641.0859,771.5,1645.0859,767.5,1641.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="765.5" x2="1104.5" y1="1641.0859" y2="1641.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="777.5" y="1636.02">LOOK-27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="254" x="844.5" y="1636.02">MojaloopFSPIOPError response recieved</text><polygon fill="#A80036" points="494.5,1666.2188,484.5,1670.2188,494.5,1674.2188,490.5,1670.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="488.5" x2="754.5" y1="1670.2188" y2="1670.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="500.5" y="1665.1528">LOOK-28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="567.5" y="1665.1528">return MojaloopFSPIOPError</text><polygon fill="#A80036" points="82.5,1695.3516,72.5,1699.3516,82.5,1703.3516,78.5,1699.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="76.5" x2="477.5" y1="1699.3516" y2="1699.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="88.5" y="1694.2856">LOOK-29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="155.5" y="1694.2856">500 Internal Server Error ErrorInformationObject</text><!--MD5=[10e293f26b962d884308136dfff806b1]
@startuml

title PISP Discovery

participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPDiscoveryModel" as PISP_DM
  participant "inbound-server" as PISP_TP_IN
end box
box "Mojaloop"
    participant Switch
end box
box "DFSP tp-scheme-adapter"
  participant "inbound-server" as DFSP_TP_IN
  participant "DFSPDiscoveryModel" as DFSP_DM
end box

== Discovery ==
autonumber 1 "<b>LOOK-#</b>"
PISP -> PISP_TP_OUT: GET /accounts/dfspa/username1234

activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await create()
PISP_TP_OUT -> PISP_DM: model.getAccounts()

activate PISP_DM

rnote right of PISP_DM: state: requestAccounts
PISP_DM -> PISP_DM: ThirdpartyRequests.getAccounts()
PISP_DM -> Switch: GET /accounts/username1234
rnote right of PISP_DM #LightBlue
GET /accounts/username1234
  FSIOP-Source: pispa
  FSIOP-Destination: dfspa
end note

activate Switch
Switch - -> PISP_DM: 202 Accepted
deactivate PISP_DM

Switch -> DFSP_TP_IN: GET /accounts/username1234
activate DFSP_TP_IN
DFSP_TP_IN - -> Switch: 202 Accepted
deactivate Switch

DFSP_TP_IN -> DFSP_TP_IN: const model = await create()
DFSP_TP_IN -> DFSP_DM: model.retrieveAccounts()
deactivate DFSP_TP_IN

note over PISP, DFSP_DM
  HAPPY_SCENARIO: DFSP returns list of accounts.
end note

activate DFSP_DM
DFSP_DM -> DFSP_DM: DFSPBackendRequests.getUserAccounts('username1234')
DFSP_DM -> DFSP_DM: Accounts returned.
rnote right of DFSP_DM: state: accountsRetrieved

rnote left of DFSP_DM #LightBlue
NOTE: This deviates from the original design document.
      Which has the response as a top-level array which
      is a security and expandability risk.
      Fixing that here.
PUT /accounts/username1234
FSIOP-Source: dfspa
FSIOP-Destination: pispa
{
  "accounts": [
    { accountNickname: "XXXXXXnt", id: "dfspa.username.1234", currency: "ZAR" },
    { accountNickname: "SpeXXXXXXXXnt", id: "dfspa.username.5678", currency: "USD" }
  ]
}
end note

DFSP_DM -> Switch: PUT /accounts/username1234
activate Switch
Switch - -> DFSP_DM: 200 OK
deactivate DFSP_DM

Switch - -> PISP_TP_IN: PUT /accounts/username1234
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_DM: Accounts response recieved
deactivate PISP_TP_IN
activate PISP_DM
PISP_DM -> PISP_TP_OUT: return Accounts
deactivate PISP_DM
PISP_TP_OUT - -> PISP: 200 OK Accounts

note over PISP, DFSP_DM
  ERROR_SCENARIO: Switch receives 7202 No accounts found for generic ID error.
end note

activate DFSP_DM
DFSP_DM -> DFSP_DM: DFSPBackendRequests.getUserAccounts('username1234')
DFSP_DM -> DFSP_DM: No accounts returned.
DFSP_DM -> DFSP_DM: throw MojaloopFSPIOPError

rnote right of DFSP_DM: state: errored
rnote left of DFSP_DM #LightCoral
PUT /accounts/username1234/error
FSIOP-Source: dfspa
FSIOP-Destination: pispa
{
  errorInformation: {
    errorCode: '7202',
    errorDescription: 'No accounts found for generic ID'
  }
}
end note

DFSP_DM -> Switch: PUT /accounts/username1234/error
activate Switch
Switch - -> DFSP_DM: 200 OK
deactivate DFSP_DM

Switch - -> PISP_TP_IN: PUT /accounts/username1234/error
activate PISP_TP_IN
PISP_TP_IN - -> Switch: 200 OK
deactivate Switch

PISP_TP_IN -> PISP_DM: MojaloopFSPIOPError response recieved
deactivate PISP_TP_IN
activate PISP_DM
PISP_DM -> PISP_TP_OUT: return MojaloopFSPIOPError
deactivate PISP_DM
PISP_TP_OUT - -> PISP: 500 Internal Server Error ErrorInformationObject
deactivate PISP_TP_OUT
deactivate PISP

@enduml

PlantUML version 1.2021.00(Sun Jan 10 05:25:05 EST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
