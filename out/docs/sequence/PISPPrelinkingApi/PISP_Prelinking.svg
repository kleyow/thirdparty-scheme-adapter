<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2368px" preserveAspectRatio="none" style="width:1548px;height:2368px;" version="1.1" viewBox="0 0 1548 2368" width="1548px" zoomAndPan="magnify"><defs><filter height="300%" id="fmhes99ywwqww" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="143" x="699" y="28.708">PISP Pre-linking</text><rect fill="#DDDDDD" height="2321.4219" style="stroke:#A80036;stroke-width:1.0;" width="821.5" x="388.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="185" x="706.75" y="53.02">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="2321.4219" style="stroke:#A80036;stroke-width:1.0;" width="75" x="1456.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="69" x="1459.5" y="53.02">Mojaloop</text><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="630.9219" style="stroke:#A80036;stroke-width:1.0;" width="10" x="57.5" y="217.9141"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="295.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="57.5" y="1970.0781"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="630.9219" style="stroke:#A80036;stroke-width:1.0;" width="10" x="456.5" y="217.9141"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="295.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="456.5" y="1970.0781"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="190.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="775.5" y="289.1797"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="104.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="775.5" y="715.3047"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="213.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="775.5" y="1114.4297"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="213.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="775.5" y="1607.2188"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="194.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="775.5" y="2041.3438"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1137.5" y="479.9766"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="265.5938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1137.5" y="848.8359"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="250.4609" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1137.5" y="1356.7578"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1489" y="450.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="62" x2="62" y1="95.3828" y2="2273.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="62" x2="62" y1="2273.2734" y2="2314.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="62" x2="62" y1="2314.0781" y2="2324.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="461.5" x2="461.5" y1="95.3828" y2="2273.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="461.5" x2="461.5" y1="2273.2734" y2="2314.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="461.5" x2="461.5" y1="2314.0781" y2="2324.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="780.5" x2="780.5" y1="95.3828" y2="2273.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="780.5" x2="780.5" y1="2273.2734" y2="2314.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="780.5" x2="780.5" y1="2314.0781" y2="2324.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1142" x2="1142" y1="95.3828" y2="2273.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1142" x2="1142" y1="2273.2734" y2="2314.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1142" x2="1142" y1="2314.0781" y2="2324.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1494" x2="1494" y1="95.3828" y2="2273.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1494" x2="1494" y1="2273.2734" y2="2314.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1494" x2="1494" y1="2314.0781" y2="2324.0781"/><rect fill="#FEFECE" filter="url(#fmhes99ywwqww)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="111" x="5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="12" y="80.0811">PISP Backend</text><rect fill="#FEFECE" filter="url(#fmhes99ywwqww)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="111" x="5" y="2323.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="12" y="2343.0732">PISP Backend</text><rect fill="#FEFECE" filter="url(#fmhes99ywwqww)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="134" x="392.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="399.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#fmhes99ywwqww)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="134" x="392.5" y="2323.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="120" x="399.5" y="2343.0732">outbound-server</text><rect fill="#FEFECE" filter="url(#fmhes99ywwqww)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="160" x="698.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="705.5" y="80.0811">PISPPrelinkingModel</text><rect fill="#FEFECE" filter="url(#fmhes99ywwqww)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="160" x="698.5" y="2323.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="146" x="705.5" y="2343.0732">PISPPrelinkingModel</text><rect fill="#FEFECE" filter="url(#fmhes99ywwqww)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="123" x="1079" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="1086" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#fmhes99ywwqww)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="123" x="1079" y="2323.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="109" x="1086" y="2343.0732">inbound-server</text><rect fill="#FEFECE" filter="url(#fmhes99ywwqww)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="62" x="1461" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="1468" y="80.0811">Switch</text><rect fill="#FEFECE" filter="url(#fmhes99ywwqww)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="62" x="1461" y="2323.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="1468" y="2343.0732">Switch</text><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="630.9219" style="stroke:#A80036;stroke-width:1.0;" width="10" x="57.5" y="217.9141"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="295.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="57.5" y="1970.0781"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="630.9219" style="stroke:#A80036;stroke-width:1.0;" width="10" x="456.5" y="217.9141"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="295.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="456.5" y="1970.0781"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="190.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="775.5" y="289.1797"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="104.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="775.5" y="715.3047"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="213.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="775.5" y="1114.4297"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="213.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="775.5" y="1607.2188"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="194.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="775.5" y="2041.3438"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1137.5" y="479.9766"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="265.5938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1137.5" y="848.8359"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="250.4609" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1137.5" y="1356.7578"/><rect fill="#FFFFFF" filter="url(#fmhes99ywwqww)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1489" y="450.8438"/><rect fill="#EEEEEE" filter="url(#fmhes99ywwqww)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1541" x="0" y="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1541" y1="125.9492" y2="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1541" y1="128.9492" y2="128.9492"/><rect fill="#EEEEEE" filter="url(#fmhes99ywwqww)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="103" x="719" y="115.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="84" x="725" y="131.4497">Pre-Linking</text><rect fill="#ADD8E6" filter="url(#fmhes99ywwqww)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="411" x="67" y="153.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="71" y="169.5825">GET /services/THIRD_PARTY_DFSP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="403" x="71" y="184.7153">NOTE: Should we just make this request the same as ML's API?</text><polygon fill="#A80036" points="444.5,213.9141,454.5,217.9141,444.5,221.9141,448.5,217.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="67.5" x2="450.5" y1="217.9141" y2="217.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="74.5" y="212.8481">LOOK-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="133.5" y="212.8481">GET /services/THIRD_PARTY_DFSP</text><line style="stroke:#A80036;stroke-width:1.0;" x1="466.5" x2="508.5" y1="247.0469" y2="247.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="508.5" x2="508.5" y1="247.0469" y2="260.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="467.5" x2="508.5" y1="260.0469" y2="260.0469"/><polygon fill="#A80036" points="477.5,256.0469,467.5,260.0469,477.5,264.0469,473.5,260.0469" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="473.5" y="241.981">LOOK-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="532.5" y="241.981">const model = await create()</text><polygon fill="#A80036" points="763.5,285.1797,773.5,289.1797,763.5,293.1797,767.5,289.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="466.5" x2="769.5" y1="289.1797" y2="289.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="473.5" y="284.1138">LOOK-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="531.5" y="284.1138">model.getThirdpartyEnabledDFSPs()</text><rect fill="#FBFB77" filter="url(#fmhes99ywwqww)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="206" x="790" y="302.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="794" y="318.2466">state: requestTPEnabledDFSPs</text><line style="stroke:#A80036;stroke-width:1.0;" x1="785.5" x2="827.5" y1="366.5781" y2="366.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="827.5" x2="827.5" y1="366.5781" y2="379.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="786.5" x2="827.5" y1="379.5781" y2="379.5781"/><polygon fill="#A80036" points="796.5,375.5781,786.5,379.5781,796.5,383.5781,792.5,379.5781" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="792.5" y="353.9458">LOOK-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="851.5" y="346.3794">Check cache.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="851.5" y="361.5122">DFSPs not stored in cache or cache is stale.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="785.5" x2="827.5" y1="408.7109" y2="408.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="827.5" x2="827.5" y1="408.7109" y2="421.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="786.5" x2="827.5" y1="421.7109" y2="421.7109"/><polygon fill="#A80036" points="796.5,417.7109,786.5,421.7109,796.5,425.7109,792.5,421.7109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="792.5" y="403.645">LOOK-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="851.5" y="403.645">ThirdpartyRequests.getServicesById()</text><polygon fill="#A80036" points="1477,446.8438,1487,450.8438,1477,454.8438,1481,450.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="785.5" x2="1483" y1="450.8438" y2="450.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="792.5" y="445.7778">LOOK-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="851.5" y="445.7778">GET /services/THIRD_PARTY_DFSP</text><polygon fill="#A80036" points="791.5,475.9766,781.5,479.9766,791.5,483.9766,787.5,479.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="785.5" x2="1488" y1="479.9766" y2="479.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="797.5" y="474.9106">LOOK-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="856.5" y="474.9106">202 Accepted</text><path d="M19,492.9766 L19,517.9766 L1536,517.9766 L1536,502.9766 L1526,492.9766 L19,492.9766 " fill="#FBFB77" filter="url(#fmhes99ywwqww)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1526,492.9766 L1526,502.9766 L1536,502.9766 L1526,492.9766 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="609" y="510.0435">HAPPY_SCENARIO: Switch returns a non-empty list</text><polygon fill="#A80036" points="1158.5,544.2422,1148.5,548.2422,1158.5,552.2422,1154.5,548.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1152.5" x2="1488" y1="548.2422" y2="548.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="1164.5" y="543.1763">LOOK-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="1223.5" y="543.1763">PUT /services/THIRD_PARTY_DFSP</text><rect fill="#ADD8E6" filter="url(#fmhes99ywwqww)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="226" x="1258" y="561.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="1262" y="577.3091">PUT /services/THIRD_PARTY_DFSP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="1262" y="592.4419">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="1270" y="607.5747">serviceProviders: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="100" x="1278" y="622.7075">"dfspa", "dfspb"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="1270" y="637.8403">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="1262" y="652.9731">}</text><polygon fill="#A80036" points="1482,682.1719,1492,686.1719,1482,690.1719,1486,686.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1147.5" x2="1488" y1="686.1719" y2="686.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="1154.5" y="681.106">LOOK-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1213.5" y="681.106">200 OK</text><polygon fill="#A80036" points="796.5,711.3047,786.5,715.3047,796.5,719.3047,792.5,715.3047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="790.5" x2="1141.5" y1="715.3047" y2="715.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="802.5" y="710.2388">LOOK-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="871.5" y="710.2388">Services request recieved</text><line style="stroke:#A80036;stroke-width:1.0;" x1="785.5" x2="827.5" y1="744.4375" y2="744.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="827.5" x2="827.5" y1="744.4375" y2="757.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="786.5" x2="827.5" y1="757.4375" y2="757.4375"/><polygon fill="#A80036" points="796.5,753.4375,786.5,757.4375,796.5,761.4375,792.5,757.4375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="792.5" y="739.3716">LOOK-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="860.5" y="739.3716">Store DFSPs in cache</text><rect fill="#FBFB77" filter="url(#fmhes99ywwqww)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="216" x="790" y="770.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="794" y="786.5044">state: TPEnabledDFSPsResolved</text><polygon fill="#A80036" points="477.5,815.7031,467.5,819.7031,477.5,823.7031,473.5,819.7031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="471.5" x2="779.5" y1="819.7031" y2="819.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="483.5" y="814.6372">LOOK-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="551.5" y="814.6372">return TPEnabledDFSPs</text><polygon fill="#A80036" points="73.5,844.8359,63.5,848.8359,73.5,852.8359,69.5,848.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="67.5" x2="460.5" y1="848.8359" y2="848.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="79.5" y="843.77">LOOK-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="146.5" y="843.77">200 OK TPEnabledDFSPs</text><path d="M19,861.8359 L19,901.8359 L1536,901.8359 L1536,871.8359 L1526,861.8359 L19,861.8359 " fill="#FBFB77" filter="url(#fmhes99ywwqww)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1526,861.8359 L1526,871.8359 L1536,871.8359 L1526,861.8359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="301" x="601.5" y="878.9028">ERROR_SCENARIO: Switch receives 7201 error.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="339" x="601.5" y="894.0356">NOTE: What microservice is handling service lookup?</text><polygon fill="#A80036" points="1158.5,928.2344,1148.5,932.2344,1158.5,936.2344,1154.5,932.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1152.5" x2="1493" y1="932.2344" y2="932.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="1164.5" y="927.1685">LOOK-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="1232.5" y="927.1685">PUT /services/THIRD_PARTY_DFSP/error</text><rect fill="#F08080" filter="url(#fmhes99ywwqww)" height="113" style="stroke:#A80036;stroke-width:1.0;" width="349" x="1140" y="945.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="1144" y="961.3013">PUT /services/THIRD_PARTY_DFSP/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="1144" y="976.4341">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1152" y="991.5669">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="1160" y="1006.6997">errorCode: '7201',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="325" x="1160" y="1021.8325">errorDescription: 'No thirdparty enabled FSP found'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="1152" y="1036.9653">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="1144" y="1052.0981">}</text><polygon fill="#A80036" points="1482,1081.2969,1492,1085.2969,1482,1089.2969,1486,1085.2969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1147.5" x2="1488" y1="1085.2969" y2="1085.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="1154.5" y="1080.231">LOOK-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1222.5" y="1080.231">200 OK</text><polygon fill="#A80036" points="796.5,1110.4297,786.5,1114.4297,796.5,1118.4297,792.5,1114.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="790.5" x2="1141.5" y1="1114.4297" y2="1114.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="802.5" y="1109.3638">LOOK-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="870.5" y="1109.3638">ErrorInformationObject recieved</text><line style="stroke:#A80036;stroke-width:1.0;" x1="785.5" x2="827.5" y1="1143.5625" y2="1143.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="827.5" x2="827.5" y1="1143.5625" y2="1156.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="786.5" x2="827.5" y1="1156.5625" y2="1156.5625"/><polygon fill="#A80036" points="796.5,1152.5625,786.5,1156.5625,796.5,1160.5625,792.5,1156.5625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="792.5" y="1138.4966">LOOK-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="112" x="860.5" y="1138.4966">throw same error</text><rect fill="#F08080" filter="url(#fmhes99ywwqww)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="349" x="790" y="1169.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="794" y="1185.6294">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="802" y="1200.7622">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="810" y="1215.895">errorCode: '7201',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="325" x="810" y="1231.0278">errorDescription: 'No thirdparty enabled FSP found'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="802" y="1246.1606">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="794" y="1261.2935">}</text><rect fill="#FBFB77" filter="url(#fmhes99ywwqww)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="97" x="790" y="1278.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="794" y="1294.4263">state: errored</text><polygon fill="#A80036" points="472.5,1323.625,462.5,1327.625,472.5,1331.625,468.5,1327.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="466.5" x2="779.5" y1="1327.625" y2="1327.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="478.5" y="1322.5591">LOOK-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="546.5" y="1322.5591">return Error</text><polygon fill="#A80036" points="73.5,1352.7578,63.5,1356.7578,73.5,1360.7578,69.5,1356.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="67.5" x2="460.5" y1="1356.7578" y2="1356.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="79.5" y="1351.6919">LOOK-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="307" x="147.5" y="1351.6919">500 Internal Server Error ErrorInformationObject</text><path d="M19,1369.7578 L19,1394.7578 L1536,1394.7578 L1536,1379.7578 L1526,1369.7578 L19,1369.7578 " fill="#FBFB77" filter="url(#fmhes99ywwqww)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1526,1369.7578 L1526,1379.7578 L1536,1379.7578 L1526,1369.7578 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="349" x="596.5" y="1386.8247">ERROR_SCENARIO: Switch sends back any other error.</text><polygon fill="#A80036" points="1158.5,1421.0234,1148.5,1425.0234,1158.5,1429.0234,1154.5,1425.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1152.5" x2="1493" y1="1425.0234" y2="1425.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="65" x="1164.5" y="1419.9575">LOOK-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="1233.5" y="1419.9575">PUT /services/THIRD_PARTY_DFSP/error</text><rect fill="#F08080" filter="url(#fmhes99ywwqww)" height="113" style="stroke:#A80036;stroke-width:1.0;" width="270" x="1219" y="1438.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="253" x="1223" y="1454.0903">PUT /services/THIRD_PARTY_DFSP/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="1223" y="1469.2231">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="1231" y="1484.356">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="1239" y="1499.4888">errorCode: '2001',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246" x="1239" y="1514.6216">errorDescription: 'Internal server error'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="1231" y="1529.7544">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="1223" y="1544.8872">}</text><polygon fill="#A80036" points="1482,1574.0859,1492,1578.0859,1482,1582.0859,1486,1578.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1147.5" x2="1488" y1="1578.0859" y2="1578.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="1154.5" y="1573.02">LOOK-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1222.5" y="1573.02">200 OK</text><polygon fill="#A80036" points="796.5,1603.2188,786.5,1607.2188,796.5,1611.2188,792.5,1607.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="790.5" x2="1141.5" y1="1607.2188" y2="1607.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="802.5" y="1602.1528">LOOK-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="870.5" y="1602.1528">Services request recieved</text><line style="stroke:#A80036;stroke-width:1.0;" x1="785.5" x2="827.5" y1="1636.3516" y2="1636.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="827.5" x2="827.5" y1="1636.3516" y2="1649.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="786.5" x2="827.5" y1="1649.3516" y2="1649.3516"/><polygon fill="#A80036" points="796.5,1645.3516,786.5,1649.3516,796.5,1653.3516,792.5,1649.3516" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="792.5" y="1631.2856">LOOK-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="859.5" y="1631.2856">throw account linking generic Error</text><rect fill="#F08080" filter="url(#fmhes99ywwqww)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="395" x="790" y="1662.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="794" y="1678.4185">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="802" y="1693.5513">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="810" y="1708.6841">errorCode: '7200',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="371" x="810" y="1723.8169">errorDescription: 'Generic Thirdparty account linking error'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="802" y="1738.9497">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="9" x="794" y="1754.0825">}</text><rect fill="#FBFB77" filter="url(#fmhes99ywwqww)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="97" x="790" y="1771.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="794" y="1787.2153">state: errored</text><polygon fill="#A80036" points="472.5,1816.4141,462.5,1820.4141,472.5,1824.4141,468.5,1820.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="466.5" x2="779.5" y1="1820.4141" y2="1820.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="478.5" y="1815.3481">LOOK-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="546.5" y="1815.3481">return Error</text><polygon fill="#A80036" points="73.5,1845.5469,63.5,1849.5469,73.5,1853.5469,69.5,1849.5469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="67.5" x2="460.5" y1="1849.5469" y2="1849.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="64" x="79.5" y="1844.481">LOOK-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="307" x="147.5" y="1844.481">500 Internal Server Error ErrorInformationObject</text><rect fill="#EEEEEE" filter="url(#fmhes99ywwqww)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1541" x="0" y="1878.1133"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1541" y1="1878.1133" y2="1878.1133"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1541" y1="1881.1133" y2="1881.1133"/><rect fill="#EEEEEE" filter="url(#fmhes99ywwqww)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="173" x="684" y="1867.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="154" x="690" y="1883.6138">Pre-Linking - Cached</text><rect fill="#ADD8E6" filter="url(#fmhes99ywwqww)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="411" x="67" y="1905.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="71" y="1921.7466">GET /services/THIRD_PARTY_DFSP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="403" x="71" y="1936.8794">NOTE: Should we just make this request the same as ML's API?</text><polygon fill="#A80036" points="444.5,1966.0781,454.5,1970.0781,444.5,1974.0781,448.5,1970.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="67.5" x2="450.5" y1="1970.0781" y2="1970.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="74.5" y="1965.0122">LOOK-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="133.5" y="1965.0122">GET /services/THIRD_PARTY_DFSP</text><line style="stroke:#A80036;stroke-width:1.0;" x1="466.5" x2="508.5" y1="1999.2109" y2="1999.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="508.5" x2="508.5" y1="1999.2109" y2="2012.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="467.5" x2="508.5" y1="2012.2109" y2="2012.2109"/><polygon fill="#A80036" points="477.5,2008.2109,467.5,2012.2109,477.5,2016.2109,473.5,2012.2109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="473.5" y="1994.145">LOOK-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187" x="532.5" y="1994.145">const model = await create()</text><polygon fill="#A80036" points="763.5,2037.3438,773.5,2041.3438,763.5,2045.3438,767.5,2041.3438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="466.5" x2="769.5" y1="2041.3438" y2="2041.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="473.5" y="2036.2778">LOOK-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="531.5" y="2036.2778">model.getThirdpartyEnabledDFSPs()</text><rect fill="#FBFB77" filter="url(#fmhes99ywwqww)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="206" x="790" y="2054.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="794" y="2070.4106">state: requestTPEnabledDFSPs</text><line style="stroke:#A80036;stroke-width:1.0;" x1="785.5" x2="827.5" y1="2118.7422" y2="2118.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="827.5" x2="827.5" y1="2118.7422" y2="2131.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="786.5" x2="827.5" y1="2131.7422" y2="2131.7422"/><polygon fill="#A80036" points="796.5,2127.7422,786.5,2131.7422,796.5,2135.7422,792.5,2131.7422" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="792.5" y="2106.1099">LOOK-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="851.5" y="2098.5435">Check cache.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="851.5" y="2113.6763">DFSPs is stored in cache.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="785.5" x2="827.5" y1="2160.875" y2="2160.875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="827.5" x2="827.5" y1="2160.875" y2="2173.875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="786.5" x2="827.5" y1="2173.875" y2="2173.875"/><polygon fill="#A80036" points="796.5,2169.875,786.5,2173.875,796.5,2177.875,792.5,2173.875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="792.5" y="2155.8091">LOOK-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="851.5" y="2155.8091">Retrieve from cache</text><rect fill="#FBFB77" filter="url(#fmhes99ywwqww)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="216" x="790" y="2186.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="794" y="2202.9419">state: TPEnabledDFSPsResolved</text><polygon fill="#A80036" points="477.5,2232.1406,467.5,2236.1406,477.5,2240.1406,473.5,2236.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="471.5" x2="779.5" y1="2236.1406" y2="2236.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="483.5" y="2231.0747">LOOK-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="542.5" y="2231.0747">return TPEnabledDFSPs</text><polygon fill="#A80036" points="73.5,2261.2734,63.5,2265.2734,73.5,2269.2734,69.5,2265.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="67.5" x2="460.5" y1="2265.2734" y2="2265.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="55" x="79.5" y="2260.2075">LOOK-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="138.5" y="2260.2075">200 OK TPEnabledDFSPs</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="630" x="463.25" y="2297.4839">User selects their DFSP. This is a natural break point in the account linking flow due to needing end-user input</text><!--MD5=[6c8f3e6ac066efffcea5d8c0df3bf5e1]
@startuml
title PISP Pre-linking

participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPPrelinkingModel" as PISP_PLM
  participant "inbound-server" as PISP_TP_IN
end box
box "Mojaloop"
    participant Switch
end box

== Pre-Linking ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
GET /services/THIRD_PARTY_DFSP
NOTE: Should we just make this request the same as ML's API?
end note

PISP -> PISP_TP_OUT: GET /services/THIRD_PARTY_DFSP

activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await create()
PISP_TP_OUT -> PISP_PLM: model.getThirdpartyEnabledDFSPs()

activate PISP_PLM

rnote right of PISP_PLM: state: requestTPEnabledDFSPs
PISP_PLM -> PISP_PLM: Check cache.\nDFSPs not stored in cache or cache is stale.
PISP_PLM -> PISP_PLM: ThirdpartyRequests.getServicesById()
PISP_PLM -> Switch: GET /services/THIRD_PARTY_DFSP

activate Switch
Switch - -> PISP_PLM: 202 Accepted
deactivate PISP_PLM

note over PISP, Switch
  HAPPY_SCENARIO: Switch returns a non-empty list
end note

activate PISP_TP_IN

Switch - -> PISP_TP_IN: PUT /services/THIRD_PARTY_DFSP
rnote left of Switch #LightBlue
PUT /services/THIRD_PARTY_DFSP
{
  serviceProviders: [
    "dfspa", "dfspb"
  ]
}
end note
PISP_TP_IN - -> Switch: 200 OK

deactivate Switch

PISP_TP_IN -> PISP_PLM: Services request recieved

deactivate PISP_TP_IN
activate PISP_PLM

PISP_PLM -> PISP_PLM: Store DFSPs in cache
rnote right of PISP_PLM: state: TPEnabledDFSPsResolved
PISP_PLM -> PISP_TP_OUT: return TPEnabledDFSPs

deactivate PISP_PLM

PISP_TP_OUT - -> PISP: 200 OK TPEnabledDFSPs

deactivate PISP_TP_OUT
deactivate PISP

note over PISP, Switch
  ERROR_SCENARIO: Switch receives 7201 error.
  NOTE: What microservice is handling service lookup?
end note

activate PISP_TP_IN

Switch - -> PISP_TP_IN: PUT /services/THIRD_PARTY_DFSP/error
rnote left of Switch #LightCoral
PUT /services/THIRD_PARTY_DFSP/error
{
  errorInformation: {
    errorCode: '7201',
    errorDescription: 'No thirdparty enabled FSP found'
  }
}
end note
PISP_TP_IN - -> Switch: 200 OK

deactivate Switch

PISP_TP_IN -> PISP_PLM: ErrorInformationObject recieved

deactivate PISP_TP_IN
activate PISP_PLM

PISP_PLM -> PISP_PLM: throw same error
rnote right of PISP_PLM #LightCoral
{
  errorInformation: {
    errorCode: '7201',
    errorDescription: 'No thirdparty enabled FSP found'
  }
}
end note
rnote right of PISP_PLM: state: errored
PISP_PLM -> PISP_TP_OUT: return Error

deactivate PISP_PLM

PISP_TP_OUT - -> PISP: 500 Internal Server Error ErrorInformationObject

deactivate PISP_TP_OUT
deactivate PISP

note over PISP, Switch
  ERROR_SCENARIO: Switch sends back any other error.
end note

activate PISP_TP_IN

Switch - -> PISP_TP_IN: PUT /services/THIRD_PARTY_DFSP/error
rnote left of Switch #LightCoral
PUT /services/THIRD_PARTY_DFSP/error
{
  errorInformation: {
    errorCode: '2001',
    errorDescription: 'Internal server error'
  }
}
end note
PISP_TP_IN - -> Switch: 200 OK

deactivate Switch

PISP_TP_IN -> PISP_PLM: Services request recieved

deactivate PISP_TP_IN
activate PISP_PLM

PISP_PLM -> PISP_PLM: throw account linking generic Error
rnote right of PISP_PLM #LightCoral
{
  errorInformation: {
    errorCode: '7200',
    errorDescription: 'Generic Thirdparty account linking error'
  }
}
end note
rnote right of PISP_PLM: state: errored
PISP_PLM -> PISP_TP_OUT: return Error

deactivate PISP_PLM

PISP_TP_OUT - -> PISP: 500 Internal Server Error ErrorInformationObject

deactivate PISP_TP_OUT
deactivate PISP

== Pre-Linking - Cached ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
GET /services/THIRD_PARTY_DFSP
NOTE: Should we just make this request the same as ML's API?
end note

PISP -> PISP_TP_OUT: GET /services/THIRD_PARTY_DFSP

activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await create()
PISP_TP_OUT -> PISP_PLM: model.getThirdpartyEnabledDFSPs()

activate PISP_PLM

rnote right of PISP_PLM: state: requestTPEnabledDFSPs
PISP_PLM -> PISP_PLM: Check cache.\nDFSPs is stored in cache.
PISP_PLM -> PISP_PLM: Retrieve from cache
rnote right of PISP_PLM: state: TPEnabledDFSPsResolved
PISP_PLM -> PISP_TP_OUT: return TPEnabledDFSPs

deactivate PISP_PLM

PISP_TP_OUT - -> PISP: 200 OK TPEnabledDFSPs

deactivate PISP_TP_OUT
deactivate PISP

...User selects their DFSP. This is a natural break point in the account linking flow due to needing end-user input...
@enduml

PlantUML version 1.2021.5beta3(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
