<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2368px" preserveAspectRatio="none" style="width:1548px;height:2368px;" version="1.1" viewBox="0 0 1548 2368" width="1548px" zoomAndPan="magnify"><defs><filter height="300%" id="fepwz0au3otav" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="140" x="700.5" y="28.708">PISP Pre-linking</text><rect fill="#DDDDDD" height="2321.4219" style="stroke:#A80036;stroke-width:1.0;" width="816.5" x="397.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="180" x="715.75" y="53.02">PISP tp-scheme-adapter</text><rect fill="#DDDDDD" height="2321.4219" style="stroke:#A80036;stroke-width:1.0;" width="73" x="1458" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="67" x="1461" y="53.02">Mojaloop</text><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="1631.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="217.9141"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="295.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="1970.0781"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="1631.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="463.5" y="217.9141"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="295.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="463.5" y="1970.0781"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="190.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="781.5" y="289.1797"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="104.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="781.5" y="715.3047"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="213.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="781.5" y="1114.4297"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="213.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="781.5" y="1607.2188"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="194.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="781.5" y="2041.3438"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1143.5" y="479.9766"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="265.5938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1143.5" y="848.8359"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="250.4609" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1143.5" y="1356.7578"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1489.5" y="450.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="61" x2="61" y1="95.3828" y2="2273.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="61" x2="61" y1="2273.2734" y2="2314.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="61" x2="61" y1="2314.0781" y2="2324.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="468.5" x2="468.5" y1="95.3828" y2="2273.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="468.5" x2="468.5" y1="2273.2734" y2="2314.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="468.5" x2="468.5" y1="2314.0781" y2="2324.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="786" x2="786" y1="95.3828" y2="2273.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="786" x2="786" y1="2273.2734" y2="2314.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="786" x2="786" y1="2314.0781" y2="2324.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1148" x2="1148" y1="95.3828" y2="2273.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1148" x2="1148" y1="2273.2734" y2="2314.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1148" x2="1148" y1="2314.0781" y2="2324.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1494" x2="1494" y1="95.3828" y2="2273.2734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="1494" x2="1494" y1="2273.2734" y2="2314.0781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1494" x2="1494" y1="2314.0781" y2="2324.0781"/><rect fill="#FEFECE" filter="url(#fepwz0au3otav)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="12" y="80.0811">PISP Backend</text><rect fill="#FEFECE" filter="url(#fepwz0au3otav)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="109" x="5" y="2323.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="12" y="2343.0732">PISP Backend</text><rect fill="#FEFECE" filter="url(#fepwz0au3otav)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="401.5" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="408.5" y="80.0811">outbound-server</text><rect fill="#FEFECE" filter="url(#fepwz0au3otav)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="401.5" y="2323.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="408.5" y="2343.0732">outbound-server</text><rect fill="#FEFECE" filter="url(#fepwz0au3otav)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="153" x="708" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="715" y="80.0811">PISPPrelinkingModel</text><rect fill="#FEFECE" filter="url(#fepwz0au3otav)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="153" x="708" y="2323.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139" x="715" y="2343.0732">PISPPrelinkingModel</text><rect fill="#FEFECE" filter="url(#fepwz0au3otav)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1087" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1094" y="80.0811">inbound-server</text><rect fill="#FEFECE" filter="url(#fepwz0au3otav)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="119" x="1087" y="2323.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="1094" y="2343.0732">inbound-server</text><rect fill="#FEFECE" filter="url(#fepwz0au3otav)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1463" y="60.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1470" y="80.0811">Switch</text><rect fill="#FEFECE" filter="url(#fepwz0au3otav)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="59" x="1463" y="2323.0781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="45" x="1470" y="2343.0732">Switch</text><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="1631.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="217.9141"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="295.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="1970.0781"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="1631.6328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="463.5" y="217.9141"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="295.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="463.5" y="1970.0781"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="190.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="781.5" y="289.1797"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="104.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="781.5" y="715.3047"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="213.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="781.5" y="1114.4297"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="213.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="781.5" y="1607.2188"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="194.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="781.5" y="2041.3438"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1143.5" y="479.9766"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="265.5938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1143.5" y="848.8359"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="250.4609" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1143.5" y="1356.7578"/><rect fill="#FFFFFF" filter="url(#fepwz0au3otav)" height="235.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1489.5" y="450.8438"/><rect fill="#EEEEEE" filter="url(#fepwz0au3otav)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1541" x="0" y="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1541" y1="125.9492" y2="125.9492"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1541" y1="128.9492" y2="128.9492"/><rect fill="#EEEEEE" filter="url(#fepwz0au3otav)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="102" x="719.5" y="115.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="83" x="725.5" y="131.4497">Pre-Linking</text><rect fill="#ADD8E6" filter="url(#fepwz0au3otav)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="410" x="66" y="153.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="70" y="169.5825">GET /services/THIRD_PARTY_DFSP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="402" x="70" y="184.7153">NOTE: Should we just make this request the same as ML's API?</text><polygon fill="#A80036" points="451.5,213.9141,461.5,217.9141,451.5,221.9141,455.5,217.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="66.5" x2="457.5" y1="217.9141" y2="217.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="73.5" y="212.8481">LOOK-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="131.5" y="212.8481">GET /services/THIRD_PARTY_DFSP</text><line style="stroke:#A80036;stroke-width:1.0;" x1="473.5" x2="515.5" y1="247.0469" y2="247.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="515.5" x2="515.5" y1="247.0469" y2="260.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="474.5" x2="515.5" y1="260.0469" y2="260.0469"/><polygon fill="#A80036" points="484.5,256.0469,474.5,260.0469,484.5,264.0469,480.5,260.0469" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="480.5" y="241.981">LOOK-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="538.5" y="241.981">const model = await create()</text><polygon fill="#A80036" points="769.5,285.1797,779.5,289.1797,769.5,293.1797,773.5,289.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="473.5" x2="775.5" y1="289.1797" y2="289.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="480.5" y="284.1138">LOOK-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="538.5" y="284.1138">model.getThirdpartyEnabledDFSPs()</text><rect fill="#FBFB77" filter="url(#fepwz0au3otav)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="205" x="796" y="302.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="800" y="318.2466">state: requestTPEnabledDFSPs</text><line style="stroke:#A80036;stroke-width:1.0;" x1="791.5" x2="833.5" y1="366.5781" y2="366.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="833.5" x2="833.5" y1="366.5781" y2="379.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="792.5" x2="833.5" y1="379.5781" y2="379.5781"/><polygon fill="#A80036" points="802.5,375.5781,792.5,379.5781,802.5,383.5781,798.5,379.5781" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="798.5" y="353.9458">LOOK-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="856.5" y="346.3794">Check cache.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="280" x="856.5" y="361.5122">DFSPs not stored in cache or cache is stale.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="791.5" x2="833.5" y1="408.7109" y2="408.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="833.5" x2="833.5" y1="408.7109" y2="421.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="792.5" x2="833.5" y1="421.7109" y2="421.7109"/><polygon fill="#A80036" points="802.5,417.7109,792.5,421.7109,802.5,425.7109,798.5,421.7109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="798.5" y="403.645">LOOK-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="239" x="856.5" y="403.645">ThirdpartyRequests.getServicesById()</text><polygon fill="#A80036" points="1477.5,446.8438,1487.5,450.8438,1477.5,454.8438,1481.5,450.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="791.5" x2="1483.5" y1="450.8438" y2="450.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="798.5" y="445.7778">LOOK-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="856.5" y="445.7778">GET /services/THIRD_PARTY_DFSP</text><polygon fill="#A80036" points="797.5,475.9766,787.5,479.9766,797.5,483.9766,793.5,479.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="791.5" x2="1488.5" y1="479.9766" y2="479.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="803.5" y="474.9106">LOOK-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="861.5" y="474.9106">202 Accepted</text><path d="M20,492.9766 L20,517.9766 L1536,517.9766 L1536,502.9766 L1526,492.9766 L20,492.9766 " fill="#FBFB77" filter="url(#fepwz0au3otav)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1526,492.9766 L1526,502.9766 L1536,502.9766 L1526,492.9766 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322" x="610.5" y="510.0435">HAPPY_SCENARIO: Switch returns a non-empty list</text><polygon fill="#A80036" points="1164.5,544.2422,1154.5,548.2422,1164.5,552.2422,1160.5,548.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1158.5" x2="1488.5" y1="548.2422" y2="548.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="1170.5" y="543.1763">LOOK-8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="1228.5" y="543.1763">PUT /services/THIRD_PARTY_DFSP</text><rect fill="#ADD8E6" filter="url(#fepwz0au3otav)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="222" x="1262" y="561.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="1266" y="577.3091">PUT /services/THIRD_PARTY_DFSP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1266" y="592.4419">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="1274" y="607.5747">serviceProviders: [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="1282" y="622.7075">"dfspa", "dfspb"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="1274" y="637.8403">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1266" y="652.9731">}</text><polygon fill="#A80036" points="1482.5,682.1719,1492.5,686.1719,1482.5,690.1719,1486.5,686.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1153.5" x2="1488.5" y1="686.1719" y2="686.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="1160.5" y="681.106">LOOK-9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1218.5" y="681.106">200 OK</text><polygon fill="#A80036" points="802.5,711.3047,792.5,715.3047,802.5,719.3047,798.5,715.3047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="796.5" x2="1147.5" y1="715.3047" y2="715.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="808.5" y="710.2388">LOOK-10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="875.5" y="710.2388">Services request recieved</text><line style="stroke:#A80036;stroke-width:1.0;" x1="791.5" x2="833.5" y1="744.4375" y2="744.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="833.5" x2="833.5" y1="744.4375" y2="757.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="792.5" x2="833.5" y1="757.4375" y2="757.4375"/><polygon fill="#A80036" points="802.5,753.4375,792.5,757.4375,802.5,761.4375,798.5,757.4375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="798.5" y="739.3716">LOOK-11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="865.5" y="739.3716">Store DFSPs in cache</text><rect fill="#FBFB77" filter="url(#fepwz0au3otav)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="213" x="796" y="770.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="800" y="786.5044">state: TPEnabledDFSPsResolved</text><polygon fill="#A80036" points="484.5,815.7031,474.5,819.7031,484.5,823.7031,480.5,819.7031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="478.5" x2="785.5" y1="819.7031" y2="819.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="490.5" y="814.6372">LOOK-12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="557.5" y="814.6372">return TPEnabledDFSPs</text><polygon fill="#A80036" points="77.5,844.8359,67.5,848.8359,77.5,852.8359,73.5,848.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="71.5" x2="462.5" y1="848.8359" y2="848.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="83.5" y="843.77">LOOK-13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="150.5" y="843.77">200 OK TPEnabledDFSPs</text><path d="M20,861.8359 L20,901.8359 L1536,901.8359 L1536,871.8359 L1526,861.8359 L20,861.8359 " fill="#FBFB77" filter="url(#fepwz0au3otav)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1526,861.8359 L1526,871.8359 L1536,871.8359 L1526,861.8359 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="296" x="604.5" y="878.9028">ERROR_SCENARIO: Switch receives 7201 error.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="334" x="604.5" y="894.0356">NOTE: What microservice is handling service lookup?</text><polygon fill="#A80036" points="1164.5,928.2344,1154.5,932.2344,1164.5,936.2344,1160.5,932.2344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1158.5" x2="1493.5" y1="932.2344" y2="932.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1170.5" y="927.1685">LOOK-14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="1237.5" y="927.1685">PUT /services/THIRD_PARTY_DFSP/error</text><rect fill="#F08080" filter="url(#fepwz0au3otav)" height="113" style="stroke:#A80036;stroke-width:1.0;" width="348" x="1141" y="945.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="1145" y="961.3013">PUT /services/THIRD_PARTY_DFSP/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1145" y="976.4341">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="1153" y="991.5669">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="1161" y="1006.6997">errorCode: '7201',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="1161" y="1021.8325">errorDescription: 'No thirdparty enabled FSP found'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1153" y="1036.9653">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1145" y="1052.0981">}</text><polygon fill="#A80036" points="1482.5,1081.2969,1492.5,1085.2969,1482.5,1089.2969,1486.5,1085.2969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1153.5" x2="1488.5" y1="1085.2969" y2="1085.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1160.5" y="1080.231">LOOK-15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1227.5" y="1080.231">200 OK</text><polygon fill="#A80036" points="802.5,1110.4297,792.5,1114.4297,802.5,1118.4297,798.5,1114.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="796.5" x2="1147.5" y1="1114.4297" y2="1114.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="808.5" y="1109.3638">LOOK-16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="875.5" y="1109.3638">ErrorInformationObject recieved</text><line style="stroke:#A80036;stroke-width:1.0;" x1="791.5" x2="833.5" y1="1143.5625" y2="1143.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="833.5" x2="833.5" y1="1143.5625" y2="1156.5625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="792.5" x2="833.5" y1="1156.5625" y2="1156.5625"/><polygon fill="#A80036" points="802.5,1152.5625,792.5,1156.5625,802.5,1160.5625,798.5,1156.5625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="798.5" y="1138.4966">LOOK-17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="110" x="865.5" y="1138.4966">throw same error</text><rect fill="#F08080" filter="url(#fepwz0au3otav)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="348" x="796" y="1169.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="800" y="1185.6294">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="808" y="1200.7622">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="816" y="1215.895">errorCode: '7201',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="324" x="816" y="1231.0278">errorDescription: 'No thirdparty enabled FSP found'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="808" y="1246.1606">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="800" y="1261.2935">}</text><rect fill="#FBFB77" filter="url(#fepwz0au3otav)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="96" x="796" y="1278.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="800" y="1294.4263">state: errored</text><polygon fill="#A80036" points="484.5,1323.625,474.5,1327.625,484.5,1331.625,480.5,1327.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="478.5" x2="785.5" y1="1327.625" y2="1327.625"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="490.5" y="1322.5591">LOOK-18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="557.5" y="1322.5591">catch MojaloopFSPIOPError</text><polygon fill="#A80036" points="77.5,1352.7578,67.5,1356.7578,77.5,1360.7578,73.5,1356.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="71.5" x2="462.5" y1="1356.7578" y2="1356.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="83.5" y="1351.6919">LOOK-19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="150.5" y="1351.6919">500 Internal Server Error ErrorInformationObject</text><path d="M20,1369.7578 L20,1394.7578 L1536,1394.7578 L1536,1379.7578 L1526,1369.7578 L20,1369.7578 " fill="#FBFB77" filter="url(#fepwz0au3otav)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1526,1369.7578 L1526,1379.7578 L1536,1379.7578 L1526,1369.7578 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="599.5" y="1386.8247">ERROR_SCENARIO: Switch sends back any other error.</text><polygon fill="#A80036" points="1164.5,1421.0234,1154.5,1425.0234,1164.5,1429.0234,1160.5,1425.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1158.5" x2="1493.5" y1="1425.0234" y2="1425.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1170.5" y="1419.9575">LOOK-20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="1237.5" y="1419.9575">PUT /services/THIRD_PARTY_DFSP/error</text><rect fill="#F08080" filter="url(#fepwz0au3otav)" height="113" style="stroke:#A80036;stroke-width:1.0;" width="268" x="1221" y="1438.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="249" x="1225" y="1454.0903">PUT /services/THIRD_PARTY_DFSP/error</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1225" y="1469.2231">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="1233" y="1484.356">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="1241" y="1499.4888">errorCode: '2001',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="1241" y="1514.6216">errorDescription: 'Internal server error'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1233" y="1529.7544">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="1225" y="1544.8872">}</text><polygon fill="#A80036" points="1482.5,1574.0859,1492.5,1578.0859,1482.5,1582.0859,1486.5,1578.0859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1153.5" x2="1488.5" y1="1578.0859" y2="1578.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="1160.5" y="1573.02">LOOK-21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="46" x="1227.5" y="1573.02">200 OK</text><polygon fill="#A80036" points="802.5,1603.2188,792.5,1607.2188,802.5,1611.2188,798.5,1607.2188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="796.5" x2="1147.5" y1="1607.2188" y2="1607.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="808.5" y="1602.1528">LOOK-22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="875.5" y="1602.1528">Services request recieved</text><line style="stroke:#A80036;stroke-width:1.0;" x1="791.5" x2="833.5" y1="1636.3516" y2="1636.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="833.5" x2="833.5" y1="1636.3516" y2="1649.3516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="792.5" x2="833.5" y1="1649.3516" y2="1649.3516"/><polygon fill="#A80036" points="802.5,1645.3516,792.5,1649.3516,802.5,1653.3516,798.5,1649.3516" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="798.5" y="1631.2856">LOOK-23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220" x="865.5" y="1631.2856">throw account linking generic error</text><rect fill="#F08080" filter="url(#fepwz0au3otav)" height="98" style="stroke:#A80036;stroke-width:1.0;" width="392" x="796" y="1662.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="800" y="1678.4185">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="808" y="1693.5513">errorInformation: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="816" y="1708.6841">errorCode: '7200',</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="368" x="816" y="1723.8169">errorDescription: 'Generic Thirdparty account linking error'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="808" y="1738.9497">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="8" x="800" y="1754.0825">}</text><rect fill="#FBFB77" filter="url(#fepwz0au3otav)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="96" x="796" y="1771.1484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="800" y="1787.2153">state: errored</text><polygon fill="#A80036" points="484.5,1816.4141,474.5,1820.4141,484.5,1824.4141,480.5,1820.4141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="478.5" x2="785.5" y1="1820.4141" y2="1820.4141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="490.5" y="1815.3481">LOOK-24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="557.5" y="1815.3481">catch MojaloopFSPIOPError</text><polygon fill="#A80036" points="72.5,1845.5469,62.5,1849.5469,72.5,1853.5469,68.5,1849.5469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="66.5" x2="467.5" y1="1849.5469" y2="1849.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="63" x="78.5" y="1844.481">LOOK-25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="145.5" y="1844.481">500 Internal Server Error ErrorInformationObject</text><rect fill="#EEEEEE" filter="url(#fepwz0au3otav)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1541" x="0" y="1878.1133"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1541" y1="1878.1133" y2="1878.1133"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1541" y1="1881.1133" y2="1881.1133"/><rect fill="#EEEEEE" filter="url(#fepwz0au3otav)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="172" x="684.5" y="1867.5469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="153" x="690.5" y="1883.6138">Pre-Linking - Cached</text><rect fill="#ADD8E6" filter="url(#fepwz0au3otav)" height="38" style="stroke:#A80036;stroke-width:1.0;" width="410" x="66" y="1905.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="70" y="1921.7466">GET /services/THIRD_PARTY_DFSP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="402" x="70" y="1936.8794">NOTE: Should we just make this request the same as ML's API?</text><polygon fill="#A80036" points="451.5,1966.0781,461.5,1970.0781,451.5,1974.0781,455.5,1970.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="66.5" x2="457.5" y1="1970.0781" y2="1970.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="73.5" y="1965.0122">LOOK-1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="131.5" y="1965.0122">GET /services/THIRD_PARTY_DFSP</text><line style="stroke:#A80036;stroke-width:1.0;" x1="473.5" x2="515.5" y1="1999.2109" y2="1999.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="515.5" x2="515.5" y1="1999.2109" y2="2012.2109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="474.5" x2="515.5" y1="2012.2109" y2="2012.2109"/><polygon fill="#A80036" points="484.5,2008.2109,474.5,2012.2109,484.5,2016.2109,480.5,2012.2109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="480.5" y="1994.145">LOOK-2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="538.5" y="1994.145">const model = await create()</text><polygon fill="#A80036" points="769.5,2037.3438,779.5,2041.3438,769.5,2045.3438,773.5,2041.3438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="473.5" x2="775.5" y1="2041.3438" y2="2041.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="480.5" y="2036.2778">LOOK-3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231" x="538.5" y="2036.2778">model.getThirdpartyEnabledDFSPs()</text><rect fill="#FBFB77" filter="url(#fepwz0au3otav)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="205" x="796" y="2054.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="197" x="800" y="2070.4106">state: requestTPEnabledDFSPs</text><line style="stroke:#A80036;stroke-width:1.0;" x1="791.5" x2="833.5" y1="2118.7422" y2="2118.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="833.5" x2="833.5" y1="2118.7422" y2="2131.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="792.5" x2="833.5" y1="2131.7422" y2="2131.7422"/><polygon fill="#A80036" points="802.5,2127.7422,792.5,2131.7422,802.5,2135.7422,798.5,2131.7422" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="798.5" y="2106.1099">LOOK-4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="856.5" y="2098.5435">Check cache.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="161" x="856.5" y="2113.6763">DFSPs is stored in cache.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="791.5" x2="833.5" y1="2160.875" y2="2160.875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="833.5" x2="833.5" y1="2160.875" y2="2173.875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="792.5" x2="833.5" y1="2173.875" y2="2173.875"/><polygon fill="#A80036" points="802.5,2169.875,792.5,2173.875,802.5,2177.875,798.5,2173.875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="798.5" y="2155.8091">LOOK-5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="856.5" y="2155.8091">Retrieve from cache</text><rect fill="#FBFB77" filter="url(#fepwz0au3otav)" height="23" style="stroke:#A80036;stroke-width:1.0;" width="213" x="796" y="2186.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="800" y="2202.9419">state: TPEnabledDFSPsResolved</text><polygon fill="#A80036" points="484.5,2232.1406,474.5,2236.1406,484.5,2240.1406,480.5,2236.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="478.5" x2="785.5" y1="2236.1406" y2="2236.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="490.5" y="2231.0747">LOOK-6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="548.5" y="2231.0747">return TPEnabledDFSPs</text><polygon fill="#A80036" points="72.5,2261.2734,62.5,2265.2734,72.5,2269.2734,68.5,2265.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="66.5" x2="467.5" y1="2265.2734" y2="2265.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="54" x="78.5" y="2260.2075">LOOK-7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="136.5" y="2260.2075">200 OK TPEnabledDFSPs</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="805" x="375.5" y="2297.4839">PISP presents DFSPs to User. User selects their DFSP. This is a natural break point in the account linking flow due to needing end-user input</text><!--MD5=[7b7e95230c8c056674b0938a619ec0b5]
@startuml

title PISP Pre-linking

participant "PISP Backend" as PISP
box "PISP tp-scheme-adapter"
  participant "outbound-server" as PISP_TP_OUT
  participant "PISPPrelinkingModel" as PISP_PLM
  participant "inbound-server" as PISP_TP_IN
end box
box "Mojaloop"
    participant Switch
end box

== Pre-Linking ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
GET /services/THIRD_PARTY_DFSP
NOTE: Should we just make this request the same as ML's API?
end note

PISP -> PISP_TP_OUT: GET /services/THIRD_PARTY_DFSP

activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await create()
PISP_TP_OUT -> PISP_PLM: model.getThirdpartyEnabledDFSPs()

activate PISP_PLM

rnote right of PISP_PLM: state: requestTPEnabledDFSPs
PISP_PLM -> PISP_PLM: Check cache.\nDFSPs not stored in cache or cache is stale.
PISP_PLM -> PISP_PLM: ThirdpartyRequests.getServicesById()
PISP_PLM -> Switch: GET /services/THIRD_PARTY_DFSP

activate Switch
Switch - -> PISP_PLM: 202 Accepted
deactivate PISP_PLM

note over PISP, Switch
  HAPPY_SCENARIO: Switch returns a non-empty list
end note

activate PISP_TP_IN

Switch - -> PISP_TP_IN: PUT /services/THIRD_PARTY_DFSP
rnote left of Switch #LightBlue
PUT /services/THIRD_PARTY_DFSP
{
  serviceProviders: [
    "dfspa", "dfspb"
  ]
}
end note
PISP_TP_IN - -> Switch: 200 OK

deactivate Switch

PISP_TP_IN -> PISP_PLM: Services request recieved

deactivate PISP_TP_IN
activate PISP_PLM

PISP_PLM -> PISP_PLM: Store DFSPs in cache
rnote right of PISP_PLM: state: TPEnabledDFSPsResolved
PISP_PLM -> PISP_TP_OUT: return TPEnabledDFSPs

deactivate PISP_PLM

PISP_TP_OUT - -> PISP: 200 OK TPEnabledDFSPs

note over PISP, Switch
  ERROR_SCENARIO: Switch receives 7201 error.
  NOTE: What microservice is handling service lookup?
end note

activate PISP_TP_IN

Switch - -> PISP_TP_IN: PUT /services/THIRD_PARTY_DFSP/error
rnote left of Switch #LightCoral
PUT /services/THIRD_PARTY_DFSP/error
{
  errorInformation: {
    errorCode: '7201',
    errorDescription: 'No thirdparty enabled FSP found'
  }
}
end note
PISP_TP_IN - -> Switch: 200 OK

deactivate Switch

PISP_TP_IN -> PISP_PLM: ErrorInformationObject recieved

deactivate PISP_TP_IN
activate PISP_PLM

PISP_PLM -> PISP_PLM: throw same error
rnote right of PISP_PLM #LightCoral
{
  errorInformation: {
    errorCode: '7201',
    errorDescription: 'No thirdparty enabled FSP found'
  }
}
end note
rnote right of PISP_PLM: state: errored
PISP_PLM -> PISP_TP_OUT: catch MojaloopFSPIOPError

deactivate PISP_PLM

PISP_TP_OUT - -> PISP: 500 Internal Server Error ErrorInformationObject


note over PISP, Switch
  ERROR_SCENARIO: Switch sends back any other error.
end note

activate PISP_TP_IN

Switch - -> PISP_TP_IN: PUT /services/THIRD_PARTY_DFSP/error
rnote left of Switch #LightCoral
PUT /services/THIRD_PARTY_DFSP/error
{
  errorInformation: {
    errorCode: '2001',
    errorDescription: 'Internal server error'
  }
}
end note
PISP_TP_IN - -> Switch: 200 OK

deactivate Switch

PISP_TP_IN -> PISP_PLM: Services request recieved

deactivate PISP_TP_IN
activate PISP_PLM

PISP_PLM -> PISP_PLM: throw account linking generic error
rnote right of PISP_PLM #LightCoral
{
  errorInformation: {
    errorCode: '7200',
    errorDescription: 'Generic Thirdparty account linking error'
  }
}
end note
rnote right of PISP_PLM: state: errored
PISP_PLM -> PISP_TP_OUT: catch MojaloopFSPIOPError

deactivate PISP_PLM

PISP_TP_OUT - -> PISP: 500 Internal Server Error ErrorInformationObject

deactivate PISP_TP_OUT
deactivate PISP

== Pre-Linking - Cached ==
autonumber 1 "<b>LOOK-#</b>"
rnote right of PISP #LightBlue
GET /services/THIRD_PARTY_DFSP
NOTE: Should we just make this request the same as ML's API?
end note

PISP -> PISP_TP_OUT: GET /services/THIRD_PARTY_DFSP

activate PISP
activate PISP_TP_OUT

PISP_TP_OUT -> PISP_TP_OUT: const model = await create()
PISP_TP_OUT -> PISP_PLM: model.getThirdpartyEnabledDFSPs()

activate PISP_PLM

rnote right of PISP_PLM: state: requestTPEnabledDFSPs
PISP_PLM -> PISP_PLM: Check cache.\nDFSPs is stored in cache.
PISP_PLM -> PISP_PLM: Retrieve from cache
rnote right of PISP_PLM: state: TPEnabledDFSPsResolved
PISP_PLM -> PISP_TP_OUT: return TPEnabledDFSPs

deactivate PISP_PLM

PISP_TP_OUT - -> PISP: 200 OK TPEnabledDFSPs

deactivate PISP_TP_OUT
deactivate PISP

...PISP presents DFSPs to User. User selects their DFSP. This is a natural break point in the account linking flow due to needing end-user input...

@enduml

PlantUML version 1.2021.00(Sun Jan 10 05:25:05 EST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>
